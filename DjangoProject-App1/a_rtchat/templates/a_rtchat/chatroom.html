{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="chat-container">
    <!-- Chat Header -->
    <div class="chat-header">
        <div class="header-content">
            <h1 class="chat-title">{{ chat_group.group_name }}</h1>
            <div class="online-status">
                <span id="online-count">3</span> online
            </div>
        </div>
    </div>

    <!-- Chat Messages -->
    <div class="chat-messages" id="chat-messages">
        <div class="messages-container">
            {% for message in messages %}
                {% include 'a_rtchat/message.html' with message=message %}
            {% endfor %}
        </div>
    </div>

    <!-- Chat Input -->
    <div class="chat-input">
        <form id="chat-form">
            {{ form.username }}
            <div class="input-container">
                {{ form.body|add_class:"input-field" }}
            </div>
            <button type="submit" class="send-button">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z" />
                </svg>
                Send
            </button>
        </form>
    </div>
</div>

<style>
    /* General Reset */
    body, html {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: Arial, sans-serif;
    }

    /* Chat Container */
    .chat-container {
        display: flex;
        flex-direction: column;
        height: 100vh;
        background-color: #1a202c;
        color: white;
    }

    /* Chat Header */
    .chat-header {
        background-color: #2d3748;
        border-bottom: 1px solid #4a5568;
        padding: 16px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .chat-title {
        font-size: 1.5rem;
        font-weight: bold;
    }

    .online-status {
        color: #38b2ac;
        font-size: 1rem;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    /* Chat Messages */
    .chat-messages {
        flex-grow: 1;
        overflow-y: auto;
        background-color: #2d3748;
        padding: 16px;
    }

    .messages-container {
        display: flex;
        flex-direction: column;
        gap: 16px;
    }

    /* Chat Input */
    .chat-input {
        border-top: 1px solid #4a5568;
        background-color: #2d3748;
        padding: 16px;
    }

    #chat-form {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .input-container {
        flex-grow: 1;
    }

    .input-field {
        width: 100%;
        padding: 12px;
        border: none;
        border-radius: 8px;
        background-color: #4a5568;
        color: white;
        font-size: 1rem;
        outline: none;
    }

    .input-field::placeholder {
        color: #a0aec0;
    }

    .send-button {
        background-color: #5a67d8;
        color: white;
        padding: 10px 16px;
        font-size: 1rem;
        border: none;
        border-radius: 8px;
        display: flex;
        align-items: center;
        gap: 8px;
        cursor: pointer;
        transition: background-color 0.2s;
    }

    .send-button:hover {
        background-color: #4c51bf;
    }

    .icon {
        height: 20px;
        width: 20px;
    }
</style>

<script>
    const chatSocket = new WebSocket(
        'ws://' + window.location.host + '/ws/chat/{{ chat_group.group_name }}/'
    );

    const chatMessages = document.getElementById('chat-messages');
    const chatForm = document.getElementById('chat-form');
    const messageInput = document.querySelector('input[name="body"]');
    const usernameInput = document.querySelector('input[name="username"]');

    // Scroll to bottom
    function scrollToBottom() {
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }
    scrollToBottom();

    // Handle form submission
    chatForm.addEventListener('submit', function (e) {
        e.preventDefault();
        const message = messageInput.value;
        const username = usernameInput.value || 'Anonymous';

        if (message.trim()) {
            // Send message
            chatSocket.send(JSON.stringify({
                'body': message,
                'username': username
            }));
            messageInput.value = '';
            scrollToBottom();
        }
    });

    // Handle incoming messages
    chatSocket.onmessage = function (e) {
        const data = JSON.parse(e.data);
        if (data.html) {
            // Add message to chat
            const messageElement = document.createElement('div');
            messageElement.innerHTML = data.html;
            chatMessages.appendChild(messageElement);
            scrollToBottom();
        }
    };
</script>
{% endblock %}
